import"./stringify.60fa8c72.js";import{r as u,k as x,g as W,l as N,u as a,e as j,s as G,j as H,m as I,o as p,c as C,H as b,w as R,q as T,G as V,t as h,d as w,F as J,n as X}from"../app.ef79bfbe.js";function q(g,i={}){const{reconnectLimit:_=3,reconnectInterval:S=3*1e3,manual:c=u(!1),onOpen:d,onClose:m,onMessage:r,onError:v,protocols:n}=i,s=u(0),o=u(),l=u(),y=u(!1),D=u(),f=u(3),B=()=>{var e;s.value<_&&((e=l.value)==null?void 0:e.readyState)!==1&&(o.value&&clearTimeout(o.value),o.value=setTimeout(()=>{E(),s.value++},S))},E=()=>{o.value&&clearTimeout(o.value),l.value&&l.value.close();const e=new WebSocket(a(g),n);f.value=0,e.onerror=t=>{y.value||(B(),v==null||v(t,e),f.value=e.readyState||3)},e.onopen=t=>{y.value||(d==null||d(t,e),s.value=0,f.value=e.readyState||1)},e.onmessage=t=>{y.value||(r==null||r(t,e),D.value=t)},e.onclose=t=>{y.value||(B(),m==null||m(t,e),f.value=e.readyState||3)},l.value=e},L=e=>{var t;if(f.value===1)(t=l.value)==null||t.send(e);else throw new Error("WebSocket disconnected")},k=()=>{s.value=0,E()},F=()=>{var e;o.value&&clearTimeout(o.value),s.value=_,(e=l.value)==null||e.close()};return x(g)&&x(c)?W([g,c],e=>{const[t,M]=e;M||k()},{immediate:!0}):x(c)?W(c,e=>{e||k()},{immediate:!0}):c||k(),N(()=>{y.value=!0,F()}),{latestMessage:D,sendMessage:L,connect:k,disconnect:F,readyState:f,webSocketIns:l.value}}const P={style:{height:"400px",overflow:"scroll"}},Z={style:{"margin-top":"8px"}},$={style:{"margin-top":"8px"}},z={style:{"margin-top":"8px"}},A=w("p",null,"received message: ",-1),U=j({__name:"demo",setup(g){const{readyState:i,sendMessage:_,latestMessage:S,disconnect:c,connect:d}=q("wss://demo.piesocket.com/v3/channel_1?api_key=VCXCEuvhGcBDP7XhiJJUDvR1e1D3eiVjgZ9VRiaV&notify_self"),m=G(()=>S.value),r=u([]);return H(()=>{var v,n;(v=m.value)!=null&&v.data&&r.value.push((n=m.value)==null?void 0:n.data)}),(v,n)=>{const s=I("vhp-button");return p(),C("div",P,[a(i)===1?(p(),b(s,{key:0,onClick:n[0]||(n[0]=()=>a(_)&&a(_)(`${Date.now()}`))},{default:R(()=>[T("\u2709\uFE0F send")]),_:1})):V("",!0),a(i)===1?(p(),b(s,{key:1,style:{"margin-left":"8px"},onClick:n[1]||(n[1]=()=>a(c)&&a(c)())},{default:R(()=>[T(" \u274C disconnect")]),_:1})):V("",!0),a(i)!==1?(p(),b(s,{key:2,style:{"margin-left":"8px"},onClick:n[2]||(n[2]=()=>a(d)&&a(d)())},{default:R(()=>[T(h(a(i)===0?"connecting":"\u{1F4DE} connect"),1)]),_:1})):V("",!0),w("div",Z,"readyState: "+h(a(i)),1),w("div",$," message count: "+h(r.value.length),1),w("div",z,[A,(p(!0),C(J,null,X(r.value,(o,l)=>(p(),C("p",{key:l},h(o),1))),128))])])}}});export{U as _};
