import"./stringify.678a69ff.js";import"./isBrowser.46f69b0e.js";import{r as u,g as L,k as N,u as n,e as G,s as H,l as I,m as J,o as f,c as S,H as x,w as C,q as b,G as T,t as k,d as h,F as X,n as j}from"../app.d255f7e5.js";function q(w,l={}){const{reconnectLimit:p=3,reconnectInterval:_=3*1e3,manual:g=u(!1),onOpen:v,onClose:d,onMessage:r,onError:i,protocols:a}=l,o=u(0),s=u(),c=u(),y=u(!1),V=u(),m=u(3),D=()=>{var e;o.value<p&&((e=c.value)==null?void 0:e.readyState)!==1&&(s.value&&clearTimeout(s.value),s.value=setTimeout(()=>{R(),o.value++},_))},R=()=>{s.value&&clearTimeout(s.value),c.value&&c.value.close();const e=new WebSocket(n(w),a);m.value=0,e.onerror=t=>{y.value||(D(),i==null||i(t,e),m.value=e.readyState||3)},e.onopen=t=>{y.value||(v==null||v(t,e),o.value=0,m.value=e.readyState||1)},e.onmessage=t=>{y.value||(r==null||r(t,e),V.value=t)},e.onclose=t=>{y.value||(D(),d==null||d(t,e),m.value=e.readyState||3)},c.value=e},F=e=>{var t;if(m.value===1)(t=c.value)==null||t.send(e);else throw new Error("WebSocket disconnected")},B=()=>{o.value=0,R()},E=()=>{var e;s.value&&clearTimeout(s.value),o.value=p,(e=c.value)==null||e.close()};return L([w,g],e=>{const[t,W]=e;W||B()},{immediate:!0}),N(()=>{y.value=!0,E()}),{latestMessage:V,sendMessage:F,connect:B,disconnect:E,readyState:m,webSocketIns:c.value}}const M={style:{height:"400px",overflow:"scroll"}},P={style:{"margin-top":"8px"}},U={style:{"margin-top":"8px"}},Z={style:{"margin-top":"8px"}},$=h("p",null,"received message: ",-1),Q=G({__name:"demo",setup(w){const{readyState:l,sendMessage:p,latestMessage:_,disconnect:g,connect:v}=q("wss://demo.piesocket.com/v3/channel_1?api_key=VCXCEuvhGcBDP7XhiJJUDvR1e1D3eiVjgZ9VRiaV&notify_self"),d=H(()=>_==null?void 0:_.value),r=u([]);return I(()=>{var i,a;(i=d.value)!=null&&i.data&&r.value.push((a=d.value)==null?void 0:a.data)}),(i,a)=>{const o=J("vhp-button");return f(),S("div",M,[n(l)===1?(f(),x(o,{key:0,onClick:a[0]||(a[0]=()=>n(p)&&n(p)(`${Date.now()}`))},{default:C(()=>[b("\u2709\uFE0F send")]),_:1})):T("",!0),n(l)===1?(f(),x(o,{key:1,style:{"margin-left":"8px"},onClick:a[1]||(a[1]=()=>n(g)&&n(g)())},{default:C(()=>[b(" \u274C disconnect")]),_:1})):T("",!0),n(l)!==1?(f(),x(o,{key:2,style:{"margin-left":"8px"},onClick:a[2]||(a[2]=()=>n(v)&&n(v)())},{default:C(()=>[b(k(n(l)===0?"connecting":"\u{1F4DE} connect"),1)]),_:1})):T("",!0),h("div",P,"readyState: "+k(n(l)),1),h("div",U," message count: "+k(r.value.length),1),h("div",Z,[$,(f(!0),S(X,null,j(r.value,(s,c)=>(f(),S("p",{key:c},k(s),1))),128))])])}}});export{Q as _};
